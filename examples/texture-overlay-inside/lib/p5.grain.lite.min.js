/**
 * p5.grain
 *
 * @version 0.8.0-lite
 * @license MIT
 * @copyright Joseph Miclaus, Gorilla Sun
 */
class P5Grain{version="0.8.0";#t;#i;#h;#s;#n;#e;#a;#r;#o;#p=0;#u=0;#c=0;#l=0;constructor(){this.#M("float")}setup(t){"object"==typeof t&&("function"==typeof t.random&&(this.#i=t.random),"string"==typeof t.randomMode&&this.#M(t.randomMode),"object"==typeof t.instance&&(this.#t=t.instance,null!==this.#t&&(this.#i=this.#t.random))),void 0!==this.#i&&null!==this.#t||(this.#i=random)}applyMonochromaticGrain(t,i,h){i=i||!1,this.#f(h);const[s,n]=this.#g(-t,t),e=this.#n,a=e.length;let r,o,p,u,c;for(let t=0;t<a;t++)r=this.#h(s,n),o=255&e[t],p=e[t]>>8&255,u=e[t]>>16&255,c=e[t]>>24&255,o=Math.max(0,Math.min(255,o+r)),p=Math.max(0,Math.min(255,p+r)),u=Math.max(0,Math.min(255,u+r)),i&&(c=Math.max(0,Math.min(255,c+r))),e[t]=c<<24|u<<16|p<<8|o;this.#d(h)}applyChromaticGrain(t,i,h){i=i||!1,this.#f(h);const[s,n]=this.#g(-t,t),e=this.#n,a=e.length;let r,o,p,u;for(let t=0;t<a;t++)r=255&e[t],o=e[t]>>8&255,p=e[t]>>16&255,u=e[t]>>24&255,r=Math.max(0,Math.min(255,r+this.#h(s,n))),o=Math.max(0,Math.min(255,o+this.#h(s,n))),p=Math.max(0,Math.min(255,p+this.#h(s,n))),i&&(u=Math.max(0,Math.min(255,u+this.#h(s,n)))),e[t]=u<<24|p<<16|o<<8|r;this.#d(h)}tinkerPixels(t,i,h){let s,n,e;i=!1!==i,h?(h.loadPixels(),s=h.pixelDensity(),n=h.width,e=h.height):this.#t?(this.#t.loadPixels(),s=this.#t.pixelDensity(),n=this.#t.width,e=this.#t.height):(loadPixels(),s=pixelDensity(),n=width,e=height);const a=n*s*4*(e*s);for(let i=0;i<a;i+=4)t(i,a);i&&this.#d(h)}loopPixels(t,i){this.tinkerPixels(t,!1,i)}textureAnimate(t,i){const h=i&&i.atFrame?Math.round(i.atFrame):2;if(this.#p+=1,this.#p>=h){const h=i&&i.amount?Math.round(i.amount):this.#t?Math.min(this.#t.width,this.#t.height):Math.min(width,height),s=this.#i()*h,n=this.#i()*h,e=Math.trunc(s),a=Math.trunc(n),r=`${e}px ${a}px`;t instanceof HTMLElement?t.style.backgroundPosition=r:t instanceof SVGElement?(t.style.top=-a+"px",t.style.left=-e+"px"):t instanceof p5.Element&&t.style("background-position",r),this.#p=0}}textureOverlay(t,i,h){const s=h instanceof p5.Graphics;let n,e;s?(n=h.width,e=h.height):this.#t?(n=this.#t.width,e=this.#t.height):(n=width,e=height);const a=i&&i.mode?i.mode:this.#t?this.#t.MULTIPLY:MULTIPLY,r=!(!i||!i.reflect)&&i.reflect,o=!(!i||!i.animate)&&i.animate,p=i&&i.animate&&i.animate.atFrame?Math.round(i.animate.atFrame):2,u=i&&i.animate&&i.animate.amount?Math.round(i.animate.amount):Math.min(n,e),c=i&&"number"==typeof i.width?i.width:t.width,l=i&&"number"==typeof i.height?i.height:t.height;if(o&&(this.#u+=1,this.#u>=p)){const t=this.#i()*u,i=this.#i()*u;this.#c=-Math.trunc(t),this.#l=-Math.trunc(i),this.#u=0}let M=this.#c,f=this.#l,g=!0,d=!0;for(h?h.blendMode(a):this.#t?this.#t.blendMode(a):blendMode(a);f<e;){for(;M<n;){if(r?(s?h.push():this.#t?this.#t.push():push(),g?d?s?h.image(t,M,f,c,l):this.#t?this.#t.image(t,M,f,c,l):image(t,M,f,c,l):s?(h.scale(-1,1),h.image(t,-M,f,-c,l)):this.#t?(this.#t.scale(-1,1),this.#t.image(t,-M,f,-c,l)):(scale(-1,1),image(t,-M,f,-c,l)):d?s?(h.scale(1,-1),h.image(t,M,-f,c,-l)):this.#t?(this.#t.scale(1,-1),this.#t.image(t,M,-f,c,-l)):(scale(1,-1),image(t,M,-f,c,-l)):s?(h.scale(-1,-1),h.image(t,-M,-f,-c,-l)):this.#t?(this.#t.scale(-1,-1),this.#t.image(t,-M,-f,-c,-l)):(scale(-1,-1),image(t,-M,-f,-c,-l)),s?h.pop():this.#t?this.#t.pop():pop()):s?h.image(t,M,f,c,l):this.#t?this.#t.image(t,M,f,c,l):image(t,M,f,c,l),M+=c,M>=n){d=!0,M=this.#c,f+=l;break}d=!d}g=!g}h?h.blendMode(this.#t?this.#t.BLEND:BLEND):this.#t?this.#t.blendMode(this.#t.BLEND):blendMode(BLEND),s&&h.reset()}#M(t){switch(t){case"int":this.#s=1,this.#h=this.#x;break;case"float":this.#s=0,this.#h=this.#m}}#g(t,i){return 1==this.#s?[Math.ceil(t),Math.floor(i)]:[t,i]}#x(t,i){return Math.floor(this.#i()*(i-t+1)+t)}#m(t,i){return this.#i()*(i-t)+t}#f(t){const i=(t,i,h,s)=>{this.#n=new Uint32Array(t),this.#a=i,this.#r=h,this.#o=s,this.#e=i*h};t?(t.loadPixels(),i(t.pixels.buffer,t.width,t.height,t.pixelDensity())):this.#t?(this.#t.loadPixels(),i(this.#t.pixels.buffer,this.#t.width,this.#t.height,this.#t.pixelDensity())):(loadPixels(),i(pixels.buffer,width,height,pixelDensity()))}#d(t){t?t.updatePixels():this.#t?this.#t.updatePixels():updatePixels()}}const p5grain=new P5Grain;p5.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i)},p5.Graphics.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.Image.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i)},p5.Graphics.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.Image.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i)},p5.Graphics.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.Image.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i)},p5.Graphics.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.Image.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.prototype.textureAnimate=function(t,i){return p5grain.textureAnimate(t,i)},p5.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i)},p5.Graphics.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i,this)};