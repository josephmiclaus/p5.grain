/**
 * p5.grain
 *
 * @version 0.8.0
 * @license MIT
 * @copyright Joseph Miclaus, Gorilla Sun
 */
class P5Grain{version="0.8.0";#t;ignoreWarnings=!1;ignoreErrors=!1;#e;#i;#n;#r;#a;#o;#s;#p;#h;#l=0;#c=0;#u=0;#d=0;constructor(){this.#f("float")}setup(t){this.#g("setup",arguments)&&("object"==typeof t&&("function"==typeof t.random&&(this.#i=t.random),"string"==typeof t.randomMode&&this.#f(t.randomMode),"object"==typeof t.instance&&(this.#t=t.instance,null!==this.#t&&(this.#i=this.#t.random)),"boolean"==typeof t.ignoreWarnings&&(this.ignoreWarnings=t.ignoreWarnings),"boolean"==typeof t.ignoreErrors&&(this.ignoreErrors=t.ignoreErrors)),void 0!==this.#i&&null!==this.#t||(this.#i=random))}applyMonochromaticGrain(t,e,i){if(!this.#g("applyMonochromaticGrain",arguments))return;e=e||!1,this.#m(i);const[n,r]=this.#y(-t,t),a=this.#a,o=a.length;let s,p,h,l,c;for(let t=0;t<o;t++)s=this.#n(n,r),p=255&a[t],h=a[t]>>8&255,l=a[t]>>16&255,c=a[t]>>24&255,p=Math.max(0,Math.min(255,p+s)),h=Math.max(0,Math.min(255,h+s)),l=Math.max(0,Math.min(255,l+s)),e&&(c=Math.max(0,Math.min(255,c+s))),a[t]=c<<24|l<<16|h<<8|p;this.#b(i)}applyChromaticGrain(t,e,i){if(!this.#g("applyChromaticGrain",arguments))return;e=e||!1,this.#m(i);const[n,r]=this.#y(-t,t),a=this.#a,o=a.length;let s,p,h,l;for(let t=0;t<o;t++)s=255&a[t],p=a[t]>>8&255,h=a[t]>>16&255,l=a[t]>>24&255,s=Math.max(0,Math.min(255,s+this.#n(n,r))),p=Math.max(0,Math.min(255,p+this.#n(n,r))),h=Math.max(0,Math.min(255,h+this.#n(n,r))),e&&(l=Math.max(0,Math.min(255,l+this.#n(n,r)))),a[t]=l<<24|h<<16|p<<8|s;this.#b(i)}tinkerPixels(t,e,i){if(!this.#g("tinkerPixels",arguments))return;let n,r,a;e=!1!==e,i?(i.loadPixels(),n=i.pixelDensity(),r=i.width,a=i.height):this.#t?(this.#t.loadPixels(),n=this.#t.pixelDensity(),r=this.#t.width,a=this.#t.height):(loadPixels(),n=pixelDensity(),r=width,a=height);const o=r*n*4*(a*n);for(let e=0;e<o;e+=4)t(e,o);e&&this.#b(i)}loopPixels(t,e){this.#e="loopPixels",this.tinkerPixels(t,!1,e)}textureAnimate(t,e){if(!this.#g("textureAnimate",arguments))return;const i=e&&e.atFrame?Math.round(e.atFrame):2;if(this.#l+=1,this.#l>=i){const i=e&&e.amount?Math.round(e.amount):this.#t?Math.min(this.#t.width,this.#t.height):Math.min(width,height),n=this.#i()*i,r=this.#i()*i,a=Math.trunc(n),o=Math.trunc(r),s=`${a}px ${o}px`;t instanceof HTMLElement?t.style.backgroundPosition=s:t instanceof SVGElement?(t.style.top=-o+"px",t.style.left=-a+"px"):t instanceof p5.Element&&t.style("background-position",s),this.#l=0}}textureOverlay(t,e,i){if(!this.#g("textureOverlay",arguments))return;const n=i instanceof p5.Graphics;let r,a;n?(r=i.width,a=i.height):this.#t?(r=this.#t.width,a=this.#t.height):(r=width,a=height);const o=e&&e.mode?e.mode:this.#t?this.#t.MULTIPLY:MULTIPLY,s=!(!e||!e.reflect)&&e.reflect,p=!(!e||!e.animate)&&e.animate,h=e&&e.animate&&e.animate.atFrame?Math.round(e.animate.atFrame):2,l=e&&e.animate&&e.animate.amount?Math.round(e.animate.amount):Math.min(r,a),c=e&&"number"==typeof e.width?e.width:t.width,u=e&&"number"==typeof e.height?e.height:t.height;if(p&&(this.#c+=1,this.#c>=h)){const t=this.#i()*l,e=this.#i()*l;this.#u=-Math.trunc(t),this.#d=-Math.trunc(e),this.#c=0}let d=this.#u,f=this.#d,g=!0,m=!0;for(i?i.blendMode(o):this.#t?this.#t.blendMode(o):blendMode(o);f<a;){for(;d<r;){if(s?(n?i.push():this.#t?this.#t.push():push(),g?m?n?i.image(t,d,f,c,u):this.#t?this.#t.image(t,d,f,c,u):image(t,d,f,c,u):n?(i.scale(-1,1),i.image(t,-d,f,-c,u)):this.#t?(this.#t.scale(-1,1),this.#t.image(t,-d,f,-c,u)):(scale(-1,1),image(t,-d,f,-c,u)):m?n?(i.scale(1,-1),i.image(t,d,-f,c,-u)):this.#t?(this.#t.scale(1,-1),this.#t.image(t,d,-f,c,-u)):(scale(1,-1),image(t,d,-f,c,-u)):n?(i.scale(-1,-1),i.image(t,-d,-f,-c,-u)):this.#t?(this.#t.scale(-1,-1),this.#t.image(t,-d,-f,-c,-u)):(scale(-1,-1),image(t,-d,-f,-c,-u)),n?i.pop():this.#t?this.#t.pop():pop()):n?i.image(t,d,f,c,u):this.#t?this.#t.image(t,d,f,c,u):image(t,d,f,c,u),d+=c,d>=r){m=!0,d=this.#u,f+=u;break}m=!m}g=!g}i?i.blendMode(this.#t?this.#t.BLEND:BLEND):this.#t?this.#t.blendMode(this.#t.BLEND):blendMode(BLEND),n&&i.reset()}#f(t){switch(t){case"int":this.#r=1,this.#n=this.#x;break;case"float":this.#r=0,this.#n=this.#M}}#y(t,e){return 1==this.#r?[Math.ceil(t),Math.floor(e)]:[t,e]}#x(t,e){return Math.floor(this.#i()*(e-t+1)+t)}#M(t,e){return this.#i()*(e-t)+t}#m(t){const e=(t,e,i,n)=>{this.#a=new Uint32Array(t),this.#s=e,this.#p=i,this.#h=n,this.#o=e*i};t?(t.loadPixels(),e(t.pixels.buffer,t.width,t.height,t.pixelDensity())):this.#t?(this.#t.loadPixels(),e(this.#t.pixels.buffer,this.#t.width,this.#t.height,this.#t.pixelDensity())):(loadPixels(),e(pixels.buffer,width,height,pixelDensity()))}#b(t){t?t.updatePixels():this.#t?this.#t.updatePixels():updatePixels()}#G(t){return console.error(`[p5.grain] Error: ${t}`),!1}_warn(t){console.warn(`[p5.grain] Warning: ${t}`)}#g(t,e){if(!this.ignoreErrors)switch("string"==typeof this.#e&&(t=this.#e,this.#e=void 0),t){case"setup":if(void 0!==e[0]&&"object"!=typeof e[0])return this.#G(`The optional config argument passed to p5grain.${t}() must be of type object.`);if("object"==typeof e[0]){if(void 0!==e[0].random&&"function"!=typeof e[0].random)return this.#G(`The optional config.random property passed to p5grain.${t}() must be of type function.`);if(void 0!==e[0].randomMode&&"int"!==e[0].randomMode&&"float"!==e[0].randomMode)return this.#G(`The optional config.randomMode property passed to p5grain.${t}() must be either 'int' or 'float'.`);if(void 0!==e[0].ignoreErrors&&"boolean"!=typeof e[0].ignoreErrors)return this.#G(`The optional config.ignoreErrors property passed to p5grain.${t}() must be of type boolean.`);if(void 0!==e[0].ignoreWarnings&&"boolean"!=typeof e[0].ignoreWarnings)return this.#G(`The optional config.ignoreWarnings property passed to p5grain.${t}() must be of type boolean.`);if(void 0!==e[0].instance&&"object"!=typeof e[0].instance)return this.#G(`The optional config.instance property passed to p5grain.${t}() must be either of type object or null.`)}break;case"applyMonochromaticGrain":case"applyChromaticGrain":if("number"!=typeof e[0])return this.#G(`The amount argument passed to ${t}() must be of type number.`);if(void 0!==e[1]&&"boolean"!=typeof e[1])return this.#G(`The optional shouldUpdateAlpha argument passed to ${t}() must be of type boolean.`);if(void 0!==e[2]&&!(e[2]instanceof p5.Graphics||e[2]instanceof p5.Image))return this.#G(`The offscreen graphics buffer for ${t}() must be an instance of p5.Graphics or p5.Image.`);break;case"tinkerPixels":case"loopPixels":if("function"!=typeof e[0])return this.#G(`The callback argument passed to ${t}() must be of type function.`);if(void 0!==e[1]&&"boolean"!=typeof e[1])return this.#G(`The optional shouldUpdate argument for ${t}() must be an instance of boolean.`);if(void 0!==e[2]&&!(e[2]instanceof p5.Graphics||e[2]instanceof p5.Image))return this.#G(`The offscreen graphics buffer for ${t}() must be an instance of p5.Graphics or p5.Image.`);break;case"textureAnimate":if(!(e[0]instanceof HTMLElement||e[0]instanceof SVGElement||e[0]instanceof p5.Element))return this.#G(`The textureElement argument passed to ${t}() must be an instance of HTMLElement, SVGElement or p5.Element.`);if(void 0!==e[1]&&"object"!=typeof e[1])return this.#G(`The optional config argument passed to ${t}() must be of type object.`);if("object"==typeof e[1]){if(void 0!==e[1].atFrame&&"number"!=typeof e[1].atFrame)return this.#G(`The optional config.atFrame property passed to ${t}() must be of type number.`);if(void 0!==e[1].amount&&"number"!=typeof e[1].amount)return this.#G(`The optional config.amount argument passed to ${t}() must be of type number.`)}break;case"textureOverlay":if(!(e[0]instanceof p5.Image||e[0]instanceof p5.Graphics))return this.#G(`The texture passed to ${t}() must be an instance of p5.Image or p5.Graphics.`);if(void 0!==e[1]&&"object"!=typeof e[1])return this.#G(`The optional config argument passed to ${t}() must be of type object.`);if("object"==typeof e[1]){if(void 0!==e[1].width&&"number"!=typeof e[1].width)return this.#G(`The optional config.width property passed to ${t}() must be of type number.`);if(void 0!==e[1].height&&"number"!=typeof e[1].height)return this.#G(`The optional config.height property passed to ${t}() must be of type number.`);if(void 0!==e[1].mode&&"string"!=typeof e[1].mode)return this.#G(`The optional config.mode property passed to ${t}() must be of type string.`);if(void 0!==e[1].reflect&&"boolean"!=typeof e[1].reflect)return this.#G(`The optional config.reflect property passed to ${t}() must be of type boolean.`)}if(void 0!==e[2]&&!(e[2]instanceof p5.Graphics))return this.#G(`The offscreen graphics buffer for ${t}() must be an instance of p5.Graphics.`)}return!0}}const p5grain=new P5Grain;p5.prototype.hasOwnProperty("applyMonochromaticGrain")?p5grain.ignoreWarnings||p5grain._warn("applyMonochromaticGrain() could not be registered, since it's already defined. Use p5grain.applyMonochromaticGrain() instead."):p5.prototype.applyMonochromaticGrain=function(t,e){return p5grain.applyMonochromaticGrain(t,e)},p5.Graphics.prototype.hasOwnProperty("applyMonochromaticGrain")?p5grain.ignoreWarnings||p5grain._warn("p5.Graphics.applyMonochromaticGrain() could not be registered, since it's already defined. Use p5grain.applyMonochromaticGrain(amount, shouldUpdateAlpha, pg) instead."):p5.Graphics.prototype.applyMonochromaticGrain=function(t,e){return p5grain.applyMonochromaticGrain(t,e,this)},p5.Image.prototype.hasOwnProperty("applyMonochromaticGrain")?p5grain.ignoreWarnings||p5grain._warn("p5.Image.applyMonochromaticGrain() could not be registered, since it's already defined. Use p5grain.applyMonochromaticGrain(amount, shouldUpdateAlpha, img) instead."):p5.Image.prototype.applyMonochromaticGrain=function(t,e){return p5grain.applyMonochromaticGrain(t,e,this)},p5.prototype.hasOwnProperty("applyChromaticGrain")?p5grain.ignoreWarnings||p5grain._warn("applyChromaticGrain() could not be registered, since it's already defined. Use p5grain.applyChromaticGrain() instead."):p5.prototype.applyChromaticGrain=function(t,e){return p5grain.applyChromaticGrain(t,e)},p5.Graphics.prototype.hasOwnProperty("applyChromaticGrain")?p5grain.ignoreWarnings||p5grain._warn("p5.Graphics.applyChromaticGrain() could not be registered, since it's already defined. Use p5grain.applyChromaticGrain(amount, shouldUpdateAlpha, pg) instead."):p5.Graphics.prototype.applyChromaticGrain=function(t,e){return p5grain.applyChromaticGrain(t,e,this)},p5.Image.prototype.hasOwnProperty("applyChromaticGrain")?p5grain.ignoreWarnings||p5grain._warn("p5.Image.applyChromaticGrain() could not be registered, since it's already defined. Use p5grain.applyChromaticGrain(amount, shouldUpdateAlpha, img) instead."):p5.Image.prototype.applyChromaticGrain=function(t,e){return p5grain.applyChromaticGrain(t,e,this)},p5.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||p5grain._warn("tinkerPixels() could not be registered, since it's already defined. Use p5grain.tinkerPixels() instead."):p5.prototype.tinkerPixels=function(t,e){return p5grain.tinkerPixels(t,e)},p5.Graphics.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||p5grain._warn("p5.Graphics.tinkerPixels() could not be registered, since it's already defined. Use p5grain.tinkerPixels(callback, shouldUpdate, pg) instead."):p5.Graphics.prototype.tinkerPixels=function(t,e){return p5grain.tinkerPixels(t,e,this)},p5.Image.prototype.hasOwnProperty("tinkerPixels")?p5grain.ignoreWarnings||p5grain._warn("p5.Image.tinkerPixels() could not be registered, since it's already defined. Use p5grain.tinkerPixels(callback, shouldUpdate, img) instead."):p5.Image.prototype.tinkerPixels=function(t,e){return p5grain.tinkerPixels(t,e,this)},p5.prototype.hasOwnProperty("loopPixels")?p5grain.ignoreWarnings||p5grain._warn("loopPixels() could not be registered, since it's already defined. Use p5grain.loopPixels() instead."):p5.prototype.loopPixels=function(t,e){return p5grain.loopPixels(t,e)},p5.Graphics.prototype.hasOwnProperty("loopPixels")?p5grain.ignoreWarnings||p5grain._warn("p5.Graphics.loopPixels() could not be registered, since it's already defined. Use p5grain.loopPixels(callback, pg) instead."):p5.Graphics.prototype.loopPixels=function(t,e){return p5grain.loopPixels(t,e,this)},p5.Image.prototype.hasOwnProperty("loopPixels")?p5grain.ignoreWarnings||p5grain._warn("p5.Image.loopPixels() could not be registered, since it's already defined. Use p5grain.loopPixels(callback, img) instead."):p5.Image.prototype.loopPixels=function(t,e){return p5grain.loopPixels(t,e,this)},p5.prototype.hasOwnProperty("textureAnimate")?p5grain.ignoreWarnings||p5grain._warn("textureAnimate() could not be registered, since it's already defined. Use p5grain.textureAnimate() instead."):p5.prototype.textureAnimate=function(t,e){return p5grain.textureAnimate(t,e)},p5.prototype.hasOwnProperty("textureOverlay")?p5grain.ignoreWarnings||p5grain._warn("textureOverlay() could not be registered, since it's already defined. Use p5grain.textureOverlay() instead."):p5.prototype.textureOverlay=function(t,e){return p5grain.textureOverlay(t,e)},p5.Graphics.prototype.hasOwnProperty("textureOverlay")?p5grain.ignoreWarnings||p5grain._warn("p5.Graphics.textureOverlay() could not be registered, since it's already defined. Use p5grain.textureOverlay(textureImage, config, pg) instead."):p5.Graphics.prototype.textureOverlay=function(t,e){return p5grain.textureOverlay(t,e,this)};