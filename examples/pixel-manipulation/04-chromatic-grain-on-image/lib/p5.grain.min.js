/**!
 * p5.grain
 * 
 * @version 0.8.0
 * @license MIT
 * @copyright Joseph Miclaus, Gorilla Sun
 */
class P5Grain{version="0.8.0";#t;#i;#e;#n;#a;#s;#r;#o;#h;#p=0;#m=0;#l=0;#c=0;constructor(){this.#d("float")}setup(t){"object"==typeof t&&("function"==typeof t.random&&(this.#i=t.random),"string"==typeof t.randomMode&&this.#d(t.randomMode),"object"==typeof t.instance&&(this.#t=t.instance,null!==this.#t&&(this.#i=this.#t.random))),void 0!==this.#i&&null!==this.#t||(this.#i=random)}applyMonochromaticGrain(t,i,e){i=i||!1,this.#x(e);const[n,a]=this.#u(-t,t),s=this.#a,r=s.length;let o,h,p,m,l;if(i)for(let t=0;t<r;t++)o=this.#e(n,a),h=255&s[t],p=s[t]>>8&255,m=s[t]>>16&255,l=s[t]>>24&255,h=Math.max(0,Math.min(255,h+o)),p=Math.max(0,Math.min(255,p+o)),m=Math.max(0,Math.min(255,m+o)),l=Math.max(0,Math.min(255,l+o)),s[t]=l<<24|m<<16|p<<8|h;else for(let t=0;t<r;t++)o=this.#e(n,a),h=255&s[t],p=s[t]>>8&255,m=s[t]>>16&255,h=Math.max(0,Math.min(255,h+o)),p=Math.max(0,Math.min(255,p+o)),m=Math.max(0,Math.min(255,m+o)),s[t]=255<<24|m<<16|p<<8|h;this.#M(e)}applyChromaticGrain(t,i,e){i=i||!1,this.#x(e);const[n,a]=this.#u(-t,t),s=this.#a,r=s.length;if(i){let t,i,e,o;for(let h=0;h<r;h++)t=255&s[h],i=s[h]>>8&255,e=s[h]>>16&255,o=s[h]>>24&255,t=Math.max(0,Math.min(255,t+this.#e(n,a))),i=Math.max(0,Math.min(255,i+this.#e(n,a))),e=Math.max(0,Math.min(255,e+this.#e(n,a))),o=Math.max(0,Math.min(255,o+this.#e(n,a))),s[h]=o<<24|e<<16|i<<8|t}else{let t,i,e;for(let o=0;o<r;o++)t=255&s[o],i=s[o]>>8&255,e=s[o]>>16&255,t=Math.max(0,Math.min(255,t+this.#e(n,a))),i=Math.max(0,Math.min(255,i+this.#e(n,a))),e=Math.max(0,Math.min(255,e+this.#e(n,a))),s[o]=255<<24|e<<16|i<<8|t}this.#M(e)}tinkerPixels(t,i,e){let n,a,s;i=!1!==i,e?(e.loadPixels(),n=e.pixelDensity(),a=e.width,s=e.height):this.#t?(this.#t.loadPixels(),n=this.#t.pixelDensity(),a=this.#t.width,s=this.#t.height):(loadPixels(),n=pixelDensity(),a=width,s=height);const r=a*n*4*(s*n);for(let i=0;i<r;i+=4)t(i,r);i&&this.#M(e)}loopPixels(t,i){this.tinkerPixels(t,!1,i)}textureAnimate(t,i){const e=i&&i.atFrame?Math.round(i.atFrame):2;if(this.#p+=1,this.#p>=e){const e=i&&i.amount?Math.round(i.amount):this.#t?Math.min(this.#t.width,this.#t.height):Math.min(width,height),n=this.#i()*e,a=this.#i()*e,s=Math.trunc(n),r=Math.trunc(a),o=`${s}px ${r}px`;t instanceof HTMLElement?t.style.backgroundPosition=o:t instanceof SVGElement?(t.style.top=-r+"px",t.style.left=-s+"px"):t instanceof p5.Element&&t.style("background-position",o),this.#p=0}}textureOverlay(t,i,e){const n=e instanceof p5.Graphics;let a,s;n?(a=e.width,s=e.height):this.#t?(a=this.#t.width,s=this.#t.height):(a=width,s=height);const r=i&&i.mode?i.mode:this.#t?this.#t.MULTIPLY:MULTIPLY,o=!(!i||!i.reflect)&&i.reflect,h=!(!i||!i.animate)&&i.animate,p=i&&i.animate&&i.animate.atFrame?Math.round(i.animate.atFrame):2,m=i&&i.animate&&i.animate.amount?Math.round(i.animate.amount):Math.min(a,s),l=i&&"number"==typeof i.width?i.width:t.width,c=i&&"number"==typeof i.height?i.height:t.height;if(h&&(this.#m+=1,this.#m>=p)){const t=this.#i()*m,i=this.#i()*m;this.#l=-Math.trunc(t),this.#c=-Math.trunc(i),this.#m=0}let d=this.#l,x=this.#c,u=!0,M=!0;for(e?e.blendMode(r):this.#t?this.#t.blendMode(r):blendMode(r);x<s;){for(;d<a;){if(o?(n?e.push():this.#t?this.#t.push():push(),u?M?n?e.image(t,d,x,l,c):this.#t?this.#t.image(t,d,x,l,c):image(t,d,x,l,c):n?(e.scale(-1,1),e.image(t,-d,x,-l,c)):this.#t?(this.#t.scale(-1,1),this.#t.image(t,-d,x,-l,c)):(scale(-1,1),image(t,-d,x,-l,c)):M?n?(e.scale(1,-1),e.image(t,d,-x,l,-c)):this.#t?(this.#t.scale(1,-1),this.#t.image(t,d,-x,l,-c)):(scale(1,-1),image(t,d,-x,l,-c)):n?(e.scale(-1,-1),e.image(t,-d,-x,-l,-c)):this.#t?(this.#t.scale(-1,-1),this.#t.image(t,-d,-x,-l,-c)):(scale(-1,-1),image(t,-d,-x,-l,-c)),n?e.pop():this.#t?this.#t.pop():pop()):n?e.image(t,d,x,l,c):this.#t?this.#t.image(t,d,x,l,c):image(t,d,x,l,c),d+=l,d>=a){M=!0,d=this.#l,x+=c;break}M=!M}u=!u}e?e.blendMode(this.#t?this.#t.BLEND:BLEND):this.#t?this.#t.blendMode(this.#t.BLEND):blendMode(BLEND),n&&e.reset()}#d(t){switch(t){case"int":this.#n=1,this.#e=this.#y;break;case"float":this.#n=0,this.#e=this.#f}}#u(t,i){return 1==this.#n?[Math.ceil(t),Math.floor(i)]:[t,i]}#y(t,i){return Math.floor(this.#i()*(i-t+1)+t)}#f(t,i){return this.#i()*(i-t)+t}#x(t){const i=(t,i,e,n)=>{this.#a=new Uint32Array(t),this.#r=i,this.#o=e,this.#h=n,this.#s=i*e};t?(t.loadPixels(),i(t.pixels.buffer,t.width,t.height,t.pixelDensity())):this.#t?(this.#t.loadPixels(),i(this.#t.pixels.buffer,this.#t.width,this.#t.height,this.#t.pixelDensity())):(loadPixels(),i(pixels.buffer,width,height,pixelDensity()))}#M(t){t?t.updatePixels():this.#t?this.#t.updatePixels():updatePixels()}}const p5grain=new P5Grain;p5.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i)},p5.Graphics.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.Image.prototype.applyMonochromaticGrain=function(t,i){return p5grain.applyMonochromaticGrain(t,i,this)},p5.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i)},p5.Graphics.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.Image.prototype.applyChromaticGrain=function(t,i){return p5grain.applyChromaticGrain(t,i,this)},p5.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i)},p5.Graphics.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.Image.prototype.tinkerPixels=function(t,i){return p5grain.tinkerPixels(t,i,this)},p5.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i)},p5.Graphics.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.Image.prototype.loopPixels=function(t,i){return p5grain.loopPixels(t,i,this)},p5.prototype.textureAnimate=function(t,i){return p5grain.textureAnimate(t,i)},p5.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i)},p5.Graphics.prototype.textureOverlay=function(t,i){return p5grain.textureOverlay(t,i,this)};
